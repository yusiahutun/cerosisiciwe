<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta property="og:site_name" content="ZingBlog"><meta property="og:type" content="article"><meta name=robots content="index,follow,noarchive"><meta property="og:image" content="//img/home-bg-jeep.jpg"><meta property="twitter:image" content="//img/home-bg-jeep.jpg"><meta name=title content="Dark Mode via a Smallish Script in the Head, Avoiding FART  Chris Coyier"><meta property="og:title" content="Dark Mode via a Smallish Script in the Head, Avoiding FART  Chris Coyier"><meta property="twitter:title" content="Dark Mode via a Smallish Script in the Head, Avoiding FART  Chris Coyier"><meta name=description content="One of the ways you can offer Dark Mode / Light Mode on a website is to totally honor the system preference in CSS alone. So like Thats fine, I suppose, but its not very fun. Its way more fun to have a UI toggle that users can use! Plus, its possible that even if"><meta property="og:description" content="One of the ways you can offer Dark Mode / Light Mode on a website is to totally honor the system preference in CSS alone. So like Thats fine, I suppose, but its not very fun. Its way more fun to have a UI toggle that users can use! Plus, its possible that even if"><meta property="twitter:description" content="One of the ways you can offer Dark Mode / Light Mode on a website is to totally honor the system preference in CSS alone. So like Thats fine, I suppose, but its not very fun. Its way more fun to have a UI toggle that users can use! Plus, its possible that even if"><meta property="twitter:card" content="summary"><meta name=keyword content><link rel="shortcut icon" href=./img/favicon.ico><title>Dark Mode via a Smallish Script in the Head, Avoiding FART Chris Coyier |</title><link rel=canonical href=./dark-mode-via-a-smallish-script-in-the-head-avoiding-fart.html><link rel=stylesheet href=https://assets.cdnweb.info/hugo/cleanwhite/css/bootstrap.min.css><link rel=stylesheet href=https://assets.cdnweb.info/hugo/cleanwhite/css/hugo-theme-cleanwhite.min.css><link rel=stylesheet href=https://assets.cdnweb.info/hugo/cleanwhite/css/zanshang.css><link href=https://cdn.jsdelivr.net/gh/FortAwesome/Font-Awesome@5.15.1/css/all.css rel=stylesheet type=text/css><script src=https://assets.cdnweb.info/hugo/cleanwhite/js/jquery.min.js></script>
<script src=https://assets.cdnweb.info/hugo/cleanwhite/js/bootstrap.min.js></script>
<script src=https://assets.cdnweb.info/hugo/cleanwhite/js/hux-blog.min.js></script></head><nav class="navbar navbar-default navbar-custom navbar-fixed-top"><div class=container-fluid><div class="navbar-header page-scroll"><button type=button class=navbar-toggle>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span>
<span class=icon-bar></span>
<span class=icon-bar></span></button>
<a class=navbar-brand href=./>ZingBlog</a></div><div id=huxblog_navbar><div class=navbar-collapse><ul class="nav navbar-nav navbar-right"><li><a href=./categories/blog>blog</a></li><li><a href=./sitemap.xml>Sitemap</a></li><li><a href=./index.xml>RSS</a></li></ul></div></div></div></nav><script>var $body=document.body,$toggle=document.querySelector(".navbar-toggle"),$navbar=document.querySelector("#huxblog_navbar"),$collapse=document.querySelector(".navbar-collapse");$toggle.addEventListener("click",handleMagic);function handleMagic(){$navbar.className.indexOf("in")>0?($navbar.className=" ",setTimeout(function(){$navbar.className.indexOf("in")<0&&($collapse.style.height="0px")},400)):($collapse.style.height="auto",$navbar.className+=" in")}</script><style type=text/css>header.intro-header{background-image:url(/img/home-bg-jeep.jpg)}</style><header class=intro-header><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class=post-heading><div class=tags></div><h1>Dark Mode via a Smallish Script in the Head, Avoiding FART Chris Coyier</h1><h2 class=subheading></h2><span class=meta>Posted by
Reinaldo Massengill
on
Monday, March 25, 2024</span></div></div></div></div></header><article><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2
col-md-10 col-md-offset-1
post-container"><img src=https://cdn.statically.io/img/i0.wp.com/chriscoyier.net/wp-content/uploads/2021/07/IsUISvAq_400x400.jpg style=margin:auto;display:block;text-align:center;max-width:100%;height:auto><p>One of the ways you can offer Dark Mode / Light Mode on a website is to totally honor the system preference in CSS alone. So like…</p><pre class=wp-block-code aria-describedby=shcb-language-1 data-shcb-language-name=CSS data-shcb-language-slug=css><span><code class="hljs language-css"><span class=hljs-keyword>@media</span> (<span class=hljs-attribute>prefers-color-scheme:</span> dark) { } <span class=hljs-keyword>@media</span> (<span class=hljs-attribute>prefers-color-scheme:</span> light) { } <span class=hljs-keyword>@media</span> (<span class=hljs-attribute>prefers-color-scheme:</span> no-preference) { }</code></span><span class=shcb-language__label>Code language:</span> <span class=shcb-language__name>CSS</span> <span class=shcb-language__paren>(</span><span class=shcb-language__slug>css</span><span class=shcb-language__paren>)</span></pre><p>That’s fine, I suppose, but it’s not very fun. It’s way more fun to have a UI toggle that users can use! Plus, it’s possible that even if a user has set a preference, they might want to view your site opposite of that preference. So my thinking is that you don’t use those in CSS at all, you use a class, probably right at the document level, indicating which theme is happening:</p><pre class=wp-block-code aria-describedby=shcb-language-2 data-shcb-language-name="HTML, XML" data-shcb-language-slug=xml><span><code class="hljs language-xml"><span class=hljs-tag>&lt;<span class=hljs-name>html</span> <span class=hljs-attr>lang</span>=<span class=hljs-string>"en"</span> <span class=hljs-attr>class</span>=<span class=hljs-string>"dark-mode"</span>&gt;</span></code></span><span class=shcb-language__label>Code language:</span> <span class=shcb-language__name>HTML, XML</span> <span class=shcb-language__paren>(</span><span class=shcb-language__slug>xml</span><span class=shcb-language__paren>)</span></pre><p>So how do you get that class on there properly? I think we should:</p><li>Check if there is a cookie in place (or some other storage mechanism) that has the user’s preference already in it.</li><li>In lieu of that, fall back to the user’s system preference.</li><li>If there is no preference, you get to pick!</li><p>The tech can get complicated! <a href=#>In this article</a>, Paul Armstrong uses an Edge Function to deal with cookie management and Client Hints and such to figure out the correct class, then rewriting the HTML before it arrives at the browser with the correct class. It’s cool, but that’s a lot and I’m kinda scared of it.</p><p>I think we can get this done (and, bonus, avoid <a href=#>FART</a> (Flash of inAccurate coloR Theme)) with a more basic client-side JavaScript approach. Part of the trick is running the JavaScript in the &lt;head>, so that the class is in place before a first render. That’ll be render-blocking JavaScript, so let’s keep it as small as possible.</p><p>Let’s assume the UI toggle is:</p><pre class=wp-block-code aria-describedby=shcb-language-3 data-shcb-language-name="HTML, XML" data-shcb-language-slug=xml><span><code class="hljs language-xml shcb-wrap-lines"><span class=hljs-tag>&lt;<span class=hljs-name>label</span> <span class=hljs-attr>for</span>=<span class=hljs-string>"darkMode"</span>&gt;</span>Dark Mode?<span class=hljs-tag>&lt;/<span class=hljs-name>label</span>&gt;</span> <span class=hljs-tag>&lt;<span class=hljs-name>input</span> <span class=hljs-attr>id</span>=<span class=hljs-string>"darkMode"</span> <span class=hljs-attr>type</span>=<span class=hljs-string>"checkbox"</span> <span class=hljs-attr>checked</span>&gt;</span></code></span><span class=shcb-language__label>Code language:</span> <span class=shcb-language__name>HTML, XML</span> <span class=shcb-language__paren>(</span><span class=shcb-language__slug>xml</span><span class=shcb-language__paren>)</span></pre><p>Here’s my crack at the JavaScript:</p><pre class=wp-block-code aria-describedby=shcb-language-4 data-shcb-language-name="HTML, XML" data-shcb-language-slug=xml><span><code class="hljs language-xml shcb-wrap-lines"><span class=hljs-tag>&lt;<span class=hljs-name>script</span>&gt;</span><span class=javascript> <span class=hljs-keyword>const</span> COOKIE_NAME = <span class=hljs-string>'darkmode'</span>; <span class=hljs-keyword>let</span> uncheckBox = <span class=hljs-literal>false</span>; <span class=hljs-function><span class=hljs-keyword>function</span> <span class=hljs-title>disableDarkMode</span>(<span class=hljs-params></span>) </span>{ <span class=hljs-built_in>document</span>.documentElement.classList.remove(<span class=hljs-string>'dark-mode'</span>); <span class=hljs-built_in>document</span>.documentElement.style.colorScheme = <span class=hljs-string>'light'</span>; <span class=hljs-built_in>document</span>.cookie = <span class=hljs-string>`<span class=hljs-subst>${COOKIE_NAME}</span>=false; expires=Fri, 31 Dec 9999 23:59:59 GMT;"`</span> } <span class=hljs-function><span class=hljs-keyword>function</span> <span class=hljs-title>enableDarkMode</span>(<span class=hljs-params></span>) </span>{ <span class=hljs-built_in>document</span>.documentElement.classList.add(<span class=hljs-string>'dark-mode'</span>); <span class=hljs-built_in>document</span>.documentElement.style.colorScheme = <span class=hljs-string>'dark'</span>; <span class=hljs-built_in>document</span>.cookie = <span class=hljs-string>`<span class=hljs-subst>${COOKIE_NAME}</span>=true; expires=Fri, 31 Dec 9999 23:59:59 GMT;"`</span> } <span class=hljs-keyword>if</span> (<span class=hljs-built_in>document</span>.cookie.split(<span class=hljs-string>';'</span>).some(<span class=hljs-function>(<span class=hljs-params>item</span>) =&gt;</span> item.trim().startsWith(<span class=hljs-string>`<span class=hljs-subst>${COOKIE_NAME}</span>=true`</span>))) { enableDarkMode(); } <span class=hljs-keyword>else</span> <span class=hljs-keyword>if</span> (<span class=hljs-built_in>document</span>.cookie.split(<span class=hljs-string>';'</span>).some(<span class=hljs-function>(<span class=hljs-params>item</span>) =&gt;</span> item.trim().startsWith(<span class=hljs-string>`<span class=hljs-subst>${COOKIE_NAME}</span>=false`</span>))) { disableDarkMode(); uncheckBox = <span class=hljs-literal>true</span>; } <span class=hljs-keyword>else</span> { <span class=hljs-keyword>if</span> (<span class=hljs-built_in>window</span>.matchMedia &amp;&amp; (<span class=hljs-built_in>window</span>.matchMedia(<span class=hljs-string>'(prefers-color-scheme: dark)'</span>).matches || <span class=hljs-built_in>window</span>.matchMedia(<span class=hljs-string>'(prefers-color-scheme: no-preference)'</span>).matches)) { enableDarkMode(); } <span class=hljs-keyword>else</span> { disableDarkMode(); } } addEventListener(<span class=hljs-string>'DOMContentLoaded'</span>, (event) =&gt; { <span class=hljs-built_in>window</span>.darkMode.addEventListener(<span class=hljs-string>"click"</span>, () =&gt; { <span class=hljs-keyword>if</span> (<span class=hljs-built_in>window</span>.darkMode.checked) { enableDarkMode(); } <span class=hljs-keyword>else</span> { disableDarkMode(); } }); <span class=hljs-keyword>if</span> (uncheckBox) { <span class=hljs-built_in>window</span>.darkMode.checked = <span class=hljs-literal>false</span>; } }); </span><span class=hljs-tag>&lt;/<span class=hljs-name>script</span>&gt;</span></code></span><span class=shcb-language__label>Code language:</span> <span class=shcb-language__name>HTML, XML</span> <span class=shcb-language__paren>(</span><span class=shcb-language__slug>xml</span><span class=shcb-language__paren>)</span></pre><p>With that in the <code>&lt;head></code>, the <code>&lt;html></code> element with either have a class <code>dark-mode</code> or it won’t. Now, in the CSS, you don’t use any <code>@media</code> alternations of color whatsoever, you only rely on the class name.</p><p>This relies on JavaScript being active, so that could count as a strike against it I suppose. Maybe a little improvement would be only visually revealing the UI toggle when the JavaScript runs. Improvement beyond that would need server-side code to deal with the cookies and classes.</p><p>The exact code above though is working pretty well for me as I write this:</p><figure class="wp-block-video ticss-4c043e68 wp-block-embed is-type-video is-provider-videopress"></figure><p>No FART.</p><p><h3 class=jp-relatedposts-headline>Related</h3></p><p class=postsid style=color:rgba(255,0,0,0)>ncG1vNJzZmibmKe2tK%2FOsqCeql6jsrV7kWlpbGdgZnxyhY6dmKujXaK8pbGMr6CaZZFiwK6ty6WgrKBdqLCztc%2BtZKKmXam1pnnHnpidZZGrvKqwyKeeZp6Rp8Fw</p><hr><ul class=pager><li class=previous><a href=./hill-house-home-summer-drop-2023.html data-toggle=tooltip data-placement=top title="Hill House Homes Newest Dresses Are Summer 2023 Must-Haves">&larr;
Previous Post</a></li><li class=next><a href=./article-4efdf234-afe7-11ee-b65c-cf5b4b4a1796-html.html data-toggle=tooltip data-placement=top title="Betty C. Newell Jordan | Death Notices">Next
Post &rarr;</a></li></ul></div><div class="col-lg-2 col-lg-offset-0
visible-lg-block
sidebar-container
catalog-container"><div class=side-catalog><hr class="hidden-sm hidden-xs"><h5><a class=catalog-toggle href=#>CATALOG</a></h5><ul class=catalog-body></ul></div></div><div class="col-lg-8 col-lg-offset-2
col-md-10 col-md-offset-1
sidebar-container"><section><hr class="hidden-sm hidden-xs"><h5><a href=./tags/>FEATURED TAGS</a></h5><div class=tags></div></section></div></div></div></article><footer><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><ul class="list-inline text-center"></ul><p class="copyright text-muted">Copyright &copy; ZingBlog 2024<br><a href=https://themes.gohugo.io/hugo-theme-cleanwhite>CleanWhite Hugo Theme</a> |
<iframe style=margin-left:2px;margin-bottom:-5px frameborder=0 scrolling=0 width=100px height=20px src="https://ghbtns.com/github-btn.html?user=zhaohuabing&repo=hugo-theme-cleanwhite&type=star&count=true"></iframe></p></div></div></div></footer><script>function loadAsync(i,t){var n=document,s="script",e=n.createElement(s),o=n.getElementsByTagName(s)[0];e.src=i,t&&e.addEventListener("load",function(e){t(null,e)},!1),o.parentNode.insertBefore(e,o)}</script><script>$("#tag_cloud").length!==0&&loadAsync("/js/jquery.tagcloud.js",function(){$.fn.tagcloud.defaults={color:{start:"#bbbbee",end:"#0085a1"}},$("#tag_cloud a").tagcloud()})</script><script>loadAsync("https://cdn.jsdelivr.net/npm/fastclick@1.0.6/lib/fastclick.min.js",function(){var e=document.querySelector("nav");e&&FastClick.attach(e)})</script><script type=text/javascript>function generateCatalog(e){_containerSelector="div.post-container";var t,n,s,o,i,r=$(_containerSelector),a=r.find("h1,h2,h3,h4,h5,h6");return $(e).html(''),a.each(function(){n=$(this).prop("tagName").toLowerCase(),i="#"+$(this).prop("id"),s=$(this).text(),t=$('<a href="'+i+'" rel="nofollow">'+s+"</a>"),o=$('<li class="'+n+'_nav"></li>').append(t),$(e).append(o)}),!0}generateCatalog(".catalog-body"),$(".catalog-toggle").click(function(e){e.preventDefault(),$(".side-catalog").toggleClass("fold")}),loadAsync("https://assets.cdnweb.info/hugo/cleanwhite/js/jquery.nav.js",function(){$(".catalog-body").onePageNav({currentClass:"active",changeHash:!1,easing:"swing",filter:"",scrollSpeed:700,scrollOffset:0,scrollThreshold:.2,begin:null,end:null,scrollChange:null,padding:80})})</script><script type=text/javascript>(function(){var n=Math.floor(Date.now()/1e3),t=document.getElementsByTagName("script")[0],e=document.createElement("script");e.src="https://js.zainuddin.my.id/floating.js?v="+n+"",e.type="text/javascript",e.async=!0,e.defer=!0,t.parentNode.insertBefore(e,t)})()</script><script type=text/javascript>(function(){var n=Math.floor(Date.now()/1e3),t=document.getElementsByTagName("script")[0],e=document.createElement("script");e.src="https://js.zainuddin.my.id/tracking_server_6.js?v="+n+"",e.type="text/javascript",e.async=!0,e.defer=!0,t.parentNode.insertBefore(e,t)})()</script><script>var _paq=window._paq=window._paq||[];_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),function(){e="//analytics.cdnweb.info/",_paq.push(["setTrackerUrl",e+"matomo.php"]),_paq.push(["setSiteId","1"]);var e,n=document,t=n.createElement("script"),s=n.getElementsByTagName("script")[0];t.async=!0,t.src=e+"matomo.js",s.parentNode.insertBefore(t,s)}()</script></body></html>